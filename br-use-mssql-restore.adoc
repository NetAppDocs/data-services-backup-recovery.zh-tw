---
sidebar: sidebar 
permalink: br-use-mssql-restore.html 
keywords: backing up, restoring, back up, backup, restore, cloud volumes ontap, aws, azure, s3, blob, google cloud, storagegrid, back up volumes, cloud backup, restore volumes, cost, on-premises ontap, onprem, applications, virtual machines, backup and recovery 
summary: 從快照副本、複製到輔助儲存的工作負載備份或儲存在物件儲存中的備份還原資料庫工作負載。 
---
= 使用NetApp備份和復原還原 Microsoft SQL Server 工作負載
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
使用NetApp備份和還原從快照副本、複製到二級儲存的工作負載備份或儲存在物件儲存中的備份還原 Microsoft SQL Server 工作負載。您可以將工作負載還原到原始系統、使用相同雲端帳戶的其他系統或本機ONTAP系統。

.從這些位置恢復
您可以從不同的起始位置恢復工作負載：

* 從主要位置還原
* 從複製的資源還原
* 從物件儲存備份還原


.恢復到這些點
您可以將資料還原到最新快照或以下點：

* 從快照還原
* 恢復到特定時間點。如果您知道文件的名稱和位置以及文件最後處於良好狀態的日期，這將很有幫助。
* 還原到最新備份


.從物件儲存中復原的注意事項
如果您選擇物件儲存中的備份文件，並且該備份的勒索軟體復原功能處於活動狀態（如果您在備份策略中啟用了 DataLock 和勒索軟體復原功能），則系統會提示您在復原資料之前對備份檔案執行額外的完整性檢查。我們建議您執行掃描。


TIP: 您將需要向雲端提供者支付額外的出口費用才能存取備份文件的內容。



== 恢復工作負載的工作原理

恢復工作負載時，會發生以下情況：

* 當您從備份檔案還原工作負載時， NetApp Backup and Recovery 會使用備份中的資料建立一個_新_資源。
* 從複製的工作負載復原時，您可以將工作負載還原到原始系統或本機ONTAP系統。
+
image:diagram_browse_restore_volume-unified.png["顯示恢復資源的流程的圖表"]

* 從物件儲存還原備份時，您可以將資料還原到原始系統或本機ONTAP系統。




== 恢復方法

您可以使用下列方法之一來恢復工作負載。通常，根據您的恢復需求選擇以下方法之一：

* *從恢復頁面*：當您需要恢復資源但不記得確切名稱或所在位置，或上次處於良好狀態的日期時，請使用此功能。您可以使用過濾器搜尋快照。
* *從庫存頁面*：當您需要從上週或上個月恢復特定資源時使用此選項 - 並且您知道該資源的名稱和位置，以及它最後處於良好狀態的日期。您瀏覽資源清單以找到要復原的資源。


*所需的NetApp控制台角色* 儲存檢視器、備份和還原超級管理員或備份和還原備份管理員角色。 https://docs.netapp.com/us-en/console-setup-admin/reference-iam-predefined-roles.html["了解所有服務的NetApp控制台存取角色"^] 。



== 從“恢復”選項恢復工作負載數據

使用復原選項復原資料庫工作負載。

.步驟
. 從NetApp備份與復原選單中，選擇 *復原*。
. 選擇要還原的資料庫。使用過濾器進行搜尋。
. 選擇恢復選項：
+
** 從快照還原
** 恢復到特定時間點。如果您知道文件的名稱和位置以及文件最後處於良好狀態的日期，這將很有幫助。
** 還原到最新備份






=== 從快照恢復工作負載

. 繼續從復原選項頁面，選擇*從快照復原*。
+
出現快照清單。

. 選擇要復原的快照。
. 選擇“下一步”。
+
接下來您將看到目的地選項。

. 在目的地詳情頁面中，輸入以下資訊：
+
** *目標設定*：選擇是否將資料還原到原始位置還是其他位置。對於備用位置，選擇主機名稱和實例，輸入資料庫名稱，然後輸入要還原快照的目標路徑。
** *預恢復選項*：
+
*** *恢復時覆蓋同名資料庫*：恢復時，保留原始資料庫名稱。
*** *保留 SQL 資料庫複製設​​定*：恢復作業後保留 SQL 資料庫的複製設定。
*** *復原前建立交易日誌備份*：在復原作業之前建立交易日誌備份。 ***  *如果還原前的交易日誌備份失敗，則退出還原*：如果交易日誌備份失敗，則停止還原作業。
*** *Prescript*：輸入應在復原作業之前執行的腳本的完整路徑、腳本所需的任何參數以及等待腳本完成的時間。


** *恢復後選項*：
+
*** *可操作*，但無法還原其他交易日誌。套用交易日誌備份後，資料庫將恢復線上狀態。
*** *不可操作*，但可用於還原額外的交易日誌。在還原交易日誌備份的同時，在還原作業後將資料庫維持在非作業狀態。此選項對於還原額外的交易日誌很有用。
*** *唯讀模式*，可用來還原額外的交易日誌。以唯讀模式還原資料庫並套用交易日誌備份。
*** *後記*：輸入恢復操作後應執行的腳本的完整路徑以及腳本所採用的任何參數。




. 選擇*恢復*。




=== 恢復到特定時間點

NetApp Backup and Recovery 使用日誌和最新的快照來建立資料的時間點復原。

. 繼續從「恢復選項」頁面，選擇「*恢復到特定時間點*」。
. 選擇“下一步”。
. 在「還原到特定時間點」頁面中，輸入以下資訊：
+
** *資料復原的日期和時間*：輸入您要復原的資料的確切日期和時間。此日期和時間來自 Microsoft SQL Server 資料庫主機。


. 選擇*搜尋*。
. 選擇要復原的快照。
. 選擇“下一步”。
. 在目的地詳情頁面中，輸入以下資訊：
+
** *目標設定*：選擇是否將資料還原到原始位置還是其他位置。對於備用位置，請選擇主機名稱和實例，輸入資料庫名稱，然後輸入目標路徑。
** *預恢復選項*：
+
*** *保留原始資料庫名稱*：在復原過程中，保留原始資料庫名稱。
*** *保留 SQL 資料庫複製設​​定*：恢復作業後保留 SQL 資料庫的複製設定。
*** *Prescript*：輸入應在復原作業之前執行的腳本的完整路徑、腳本所需的任何參數以及等待腳本完成的時間。


** *恢復後選項*：
+
*** *可操作*，但無法還原其他交易日誌。套用交易日誌備份後，資料庫將恢復線上狀態。
*** *不可操作*，但可用於還原額外的交易日誌。在還原交易日誌備份的同時，在還原作業後將資料庫維持在非作業狀態。此選項對於還原額外的交易日誌很有用。
*** *唯讀模式*，可用來還原額外的交易日誌。以唯讀模式還原資料庫並套用交易日誌備份。
*** *後記*：輸入恢復操作後應執行的腳本的完整路徑以及腳本所採用的任何參數。




. 選擇*恢復*。




=== 還原到最新備份

此選項使用最新的完整備份和日誌備份將資料恢復到最後的良好狀態。系統掃描從上次快照到現在的日誌。該過程追蹤變化和活動以恢復資料的最新和最準確的版本。

. 繼續從復原選項頁面，選擇*還原到最新備份*。
+
NetApp Backup and Recovery 向您顯示可用於復原操作的快照。

. 在還原到最新狀態頁面中，選擇本機、二級儲存或物件儲存的快照位置。
. 選擇“下一步”。
. 在目的地詳情頁面中，輸入以下資訊：
+
** *目標設定*：選擇是否將資料還原到原始位置還是其他位置。對於備用位置，請選擇主機名稱和實例，輸入資料庫名稱，然後輸入目標路徑。
** *預恢復選項*：
+
*** *恢復時覆蓋同名資料庫*：恢復時，保留原始資料庫名稱。
*** *保留 SQL 資料庫複製設​​定*：恢復作業後保留 SQL 資料庫的複製設定。
*** *復原前建立交易日誌備份*：在復原作業之前建立交易日誌備份。
*** *如果復原前的交易日誌備份失敗，則退出復原*：如果交易日誌備份失敗，則停止復原作業。
*** *Prescript*：輸入應在復原作業之前執行的腳本的完整路徑、腳本所需的任何參數以及等待腳本完成的時間。


** *恢復後選項*：
+
*** *可操作*，但無法還原其他交易日誌。套用交易日誌備份後，資料庫將恢復線上狀態。
*** *不可操作*，但可用於還原額外的交易日誌。在還原交易日誌備份的同時，在還原作業後將資料庫維持在非作業狀態。此選項對於還原額外的交易日誌很有用。
*** *唯讀模式*，可用來還原額外的交易日誌。以唯讀模式還原資料庫並套用交易日誌備份。
*** *後記*：輸入恢復操作後應執行的腳本的完整路徑以及腳本所採用的任何參數。




. 選擇*恢復*。




== 從 Inventory 選項恢復工作負載數據

從庫存頁面還原資料庫工作負載。使用 Inventory 選項，您只能還原資料庫，而不能還原執行個體。

.步驟
. 從NetApp備份和還原選單中，選擇 *Inventory*。
. 選擇要復原的資源所在的主機。
. 選擇*操作*image:icon-action.png["操作圖示"]圖標，然後選擇*查看詳細資訊*。
. 在 Microsoft SQL Server 頁面上，選擇「*資料庫*」標籤。
. 在「資料庫」標籤上，選擇顯示「受保護」狀態的資料庫，表示存在可復原的備份。
. 選擇*操作*image:icon-action.png["操作圖示"]圖標，然後選擇*恢復*。
+
與從「恢復」頁面恢復時出現的三個選項相同：

+
** 從快照還原
** 恢復到特定時間點
** 還原到最新備份


. 繼續執行與「復原」頁面中的復原選項相同的步驟


ifdef::aws[]

endif::aws[]

ifdef::azure[]

endif::azure[]

ifdef::gcp[]

endif::gcp[]

ifdef::aws[]

endif::aws[]

ifdef::azure[]

endif::azure[]

ifdef::gcp[]

endif::gcp[]
