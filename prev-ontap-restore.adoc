---
sidebar: sidebar 
permalink: prev-ontap-restore.html 
keywords: backing up, back up, backup, backup application data, Amazon Web services, AWS, NetApp Backup and Recovery, Oracle database, Microsoft SQL Server database, SAP HANA database 
summary: 使用NetApp Backup and Recovery，可以從備份文件還原整個ONTAP卷，或者如果只需要還原幾個文件，則可以還原資料夾或單一文件。 
---
= 使用NetApp Backup and Recovery從備份檔案還原ONTAP數據
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
您可以從建立備份的位置取得ONTAP磁碟區資料的備份：Snapshot 副本、複製的磁碟區以及儲存在物件儲存中的備份。您可以從這些備份位置中的任何一個還原特定時間點的資料。使用NetApp Backup and Recovery，可以從備份文件還原整個ONTAP卷，或者如果只需要還原幾個文件，則可以還原資料夾或單一文件。

[]
====
*注意* 若要切換至NetApp Backup and Recovery工作負載，請參閱link:br-start-switch-ui.html["切換到不同的NetApp Backup and Recovery工作負載"]。

====
* 您可以將*磁碟區*（作為新磁碟區）還原到原始系統、使用相同雲端帳戶的其他系統或本機ONTAP系統。
* 您可以將*資料夾*還原到原始系統中的磁碟區、使用相同雲端帳戶的不同系統中的磁碟區或本機ONTAP系統上的磁碟區。
* 您可以將*檔案*還原到原始系統中的磁碟區、使用相同雲端帳戶的不同系統中的磁碟區或本機ONTAP系統上的磁碟區。


需要有效的NetApp Backup and Recovery許可證才能將資料從備份檔案還原到生產系統。

總而言之，這些是可用於將磁碟區資料還原到ONTAP系統的有效流程：

* 備份檔案 -> 還原卷
* 複製卷 -> 恢復卷
* 快照副本 -> 復原卷



NOTE: 如果還原作業未完成，請等到作業監視器顯示「失敗」後再重試還原作業。


NOTE: 有關還原ONTAP資料的限制，請參閱link:br-reference-limitations.html["ONTAP磁碟區的備份和還原限制"]。



== 恢復儀表板

您可以使用還原儀表板執行磁碟區、資料夾和檔案還原作業。您可以透過點擊控制台選單中的“備份和還原”，然後按一下“還原”標籤來存取復原儀表板。您也可以點擊image:icon-options-vertical.gif["更多按鈕"]> 從服務面板的備份和還原服務*查看恢復儀表板*。


NOTE: NetApp Backup and Recovery必須已為至少一個系統激活，並且必須存在初始備份檔案。

復原儀表板提供了兩種從備份檔案還原資料的不同方法：*瀏覽和還原*和*搜尋和還原*。



== 比較“瀏覽和還原”與“搜尋和還原”

廣義上講，當您需要恢復上週或上個月的特定卷、資料夾或文件時，_瀏覽和恢復_通常更好——並且您知道文件的名稱和位置，以及它最後處於良好狀態的日期。當您需要恢復磁碟區、資料夾或文件，但不記得確切的名稱、它所在的磁碟區或它最後處於良好狀態的日期時，_搜尋和復原_通常會更好。

表格提供了兩種方法的功能比較。

[cols="50,50"]
|===
| 瀏覽和恢復 | 搜尋和恢復 


| 瀏覽資料夾樣式結構以尋找單一備份檔案中的磁碟區、資料夾或檔案。 | 透過部分或完整磁碟區名稱、部分或完整資料夾/檔案名稱、大小範圍和其他搜尋篩選器，在*所有備份檔案*中搜尋磁碟區、資料夾或檔案。 


| 如果檔案已被刪除或重新命名，且使用者不知道原始檔案名，則不處理檔案復原 | 處理新建立/刪除/重新命名的目錄和新建立/刪除/重新命名的文件 


| 無需額外的雲端提供者資源 | 當您從雲端恢復時，每個帳戶都需要額外的儲存桶和公有雲提供者資源。 


| 無需額外的雲端提供者成本 | 當您從雲端恢復時，掃描備份和磁碟區以取得搜尋結果需要額外的費用。 


| 支援快速恢復。 | 不支援快速恢復。 
|===
此表根據備份檔案所在的位置提供了有效還原作業的清單。

[cols="14h,14,14,14,14,14,14"]
|===
| 備份類型 3+| 瀏覽和恢復 3+| 搜尋和恢復 


|  | *恢復音量* | *恢復檔案* | *恢復資料夾* | *恢復音量* | *恢復檔案* | *恢復資料夾* 


| 快照副本 | 是的 | 不 | 不 | 是的 | 是的 | 是的 


| 複製卷 | 是的 | 不 | 不 | 是的 | 是的 | 是的 


| 備份文件 | 是的 | 是的 | 是的 | 是的 | 是的 | 是的 
|===
在使用任一復原方法之前，請確保您已針對獨特的資源需求配置了環境。這些要求在以下章節中描述。

請參閱要使用的還原操作類型的要求和還原步驟：

* <<使用「瀏覽和恢復」恢復卷,使用「瀏覽和恢復」恢復卷>>
* <<使用“瀏覽和恢復”功能恢復資料夾和文件,使用“瀏覽和恢復”功能恢復資料夾和文件>>
* <<restore-ontap-data-using-search-restore,使用「搜尋和還原」功能還原磁碟區、資料夾和文件>>




== 使用“瀏覽和還原”功能還原ONTAP數據

在開始還原磁碟區、資料夾或檔案之前，您應該知道要從中還原的磁碟區的名稱、磁碟區所在的系統和 SVM 的名稱以及要從中還原的備份檔案的大致日期。您可以從 Snapshot 副本、複製的磁碟區或儲存在物件儲存中的備份中還原ONTAP資料。

*注意：*如果包含要復原的資料的備份檔案位於存檔雲端儲存中（從ONTAP 9.10.1 開始），則復原作業將花費更長的時間並產生費用。此外，目標叢集還必須執行ONTAP 9.10.1 或更高版本才能進行磁碟區還原、9.11.1 才能進行檔案還原、9.12.1 才能進行 Google Archive 和StorageGRID還原，以及 9.13.1 才能進行資料夾還原。

ifdef::aws[]

link:prev-reference-aws-archive-storage-tiers.html["了解有關從 AWS 檔案儲存恢復的更多信息"]。

endif::aws[]

ifdef::azure[]

link:prev-reference-azure-archive-storage-tiers.html["了解有關從 Azure 檔案儲存還原的詳細信息"]。

endif::azure[]

ifdef::gcp[]

link:prev-reference-gcp-archive-storage-tiers.html["詳細了解如何從 Google 存檔儲存中恢復"]。

endif::gcp[]


NOTE: 將資料從 Azure 檔案儲存還原到StorageGRID系統時不支援高優先權。



=== 瀏覽並恢復支援的系統和物件儲存提供者

您可以將ONTAP資料從位於二級系統（複製磁碟區）或物件儲存（備份檔案）中的備份檔案還原到下列系統。快照副本駐留在來源系統上，並且只能還原到同一系統。

*注意：*您可以從任何類型的備份檔案還原卷，但目前只能從物件儲存中的備份檔案還原資料夾或單一檔案。

[cols="25,25,25,25"]
|===
| *來自物件儲存（備份）* | *來自主（快照）* | *來自輔助系統（複製）* | 到目標系統 ifdef::aws[] 


| 亞馬遜 S3 | AWS 本機ONTAP系統中的Cloud Volumes ONTAP | AWS 本機ONTAP系統中的Cloud Volumes ONTAP endif::aws[] ifdef::azure[] | Azure Blob 


| Azure 本地端ONTAP系統中的Cloud Volumes ONTAP | Azure 中的Cloud Volumes ONTAP本地ONTAP系統 endif::azure[] ifdef::gcp[] | Google 雲端儲存 | Google 本機ONTAP系統中的Cloud Volumes ONTAP 


| Google 本地ONTAP系統中的Cloud Volumes ONTAP endif::gcp[] | NetAppStorageGRID | 本地ONTAP系統 | 本機ONTAP系統Cloud Volumes ONTAP 


| 到本地ONTAP系統 | ONTAP S3 | 本地ONTAP系統 | 本機ONTAP系統Cloud Volumes ONTAP 
|===
ifdef::aws[]

endif::aws[]

ifdef::azure[]

endif::azure[]

ifdef::gcp[]

endif::gcp[]

對於瀏覽和恢復，控制台代理可以安裝在以下位置：

ifdef::aws[]

* 對於 Amazon S3，控制台代理可以部署在 AWS 或您的場所


endif::aws[]

ifdef::azure[]

* 對於 Azure Blob，控制台代理程式可以部署在 Azure 中或您的本機


endif::azure[]

ifdef::gcp[]

* 對於 Google Cloud Storage，控制台代理程式必須部署在您的 Google Cloud Platform VPC 中


endif::gcp[]

* 對於StorageGRID，控制台代理必須部署在您的場所；無論是否有網路存取
* 對於ONTAP S3，控制台代理可以部署在您的場所（有或沒有網路存取）或雲端供應商環境中


請注意，「本地ONTAP系統」包括FAS、 AFF和ONTAP Select系統。


NOTE: 如果您系統上的ONTAP版本低於 9.13.1，且備份檔案已配置 DataLock 和勒索軟體，則您無法還原資料夾或檔案。在這種情況下，您可以從備份檔案還原整個卷，然後存取所需的檔案。



=== 使用「瀏覽和還原」還原卷

當您從備份檔案還原磁碟區時， NetApp Backup and Recovery會使用備份中的資料建立_新_磁碟區。使用物件儲存備份時，您可以將資料還原到原始系統中的磁碟區、與來源系統位於相同雲端帳戶的其他系統或本機ONTAP系統。

將雲端備份還原到使用ONTAP 9.13.0 或更高版本的Cloud Volumes ONTAP系統或執行ONTAP 9.14.1 的本機ONTAP系統時，您可以選擇執行_快速還原_操作。快速復原非常適合需要盡快提供對磁碟區的存取的災難復原情況。快速還原將備份檔案中的元資料還原到卷，而不是還原整個備份檔案。不建議對效能或延遲敏感的應用程式使用快速恢復，並且不支援歸檔儲存中的備份。


NOTE: 只有在建立雲端備份的來源系統執行ONTAP 9.12.1 或更高版本時， FlexGroup磁碟區才支援快速還原。並且僅當來源系統運行ONTAP 9.11.0 或更高版本時才支援SnapLock磁碟區。

從複製磁碟區還原時，您可以將磁碟區還原到原始系統或Cloud Volumes ONTAP或本機ONTAP系統。

image:diagram_browse_restore_volume.png["此圖顯示了使用瀏覽和還原執行磁碟區還原操作的流程。"]

如您所見，您需要知道來源系統名稱、儲存虛擬機器、磁碟區名稱和備份檔案日期才能執行磁碟區還原。

.步驟
. 從控制台選單中，選擇*保護>備份和還原*。
. 選擇“*恢復*”選項卡，將顯示“恢復儀表板”。
. 從「瀏覽和復原」部分，選擇「恢復磁碟區」。
. 在「選擇來源」頁面中，導覽至要還原的磁碟區的備份檔案。選擇具有要還原的日期/時間戳記的*系統*、*磁碟區*和*備份*檔案。
+
*位置*列顯示備份檔案（快照）是*本機*（來源系統上的 Snapshot 副本）、*輔助*（輔助ONTAP系統上的複製磁碟區）還是*物件儲存*（物件儲存中的備份檔案）。選擇您想要恢復的檔案。

. 選擇“下一步”。
+
請注意，如果您選擇物件儲存中的備份文件，並且該備份的勒索軟體復原功能處於活動狀態（如果您在備份策略中啟用了 DataLock 和勒索軟體復原功能），則系統會提示您在復原資料之前對備份檔案執行額外的勒索軟體掃描。我們建議您掃描備份檔案以尋找勒索軟體。  （您將需要向雲端提供者支付額外的出口費用才能存取備份檔案的內容。）

. 在「選擇目標」頁面中，選擇要恢復磁碟區的*系統*。
. 從物件儲存還原備份檔案時，如果您選擇本機ONTAP系統且尚未配置與物件儲存的叢集連接，系統將提示您輸入其他資訊：
+
ifdef::aws[]

+
** 從 Amazon S3 還原時，選擇ONTAP叢集中目標磁碟區所在的 IP 空間，輸入您建立的使用者的存取金鑰和金鑰，以授予ONTAP叢集對 S3 儲存桶的存取權限，並可選擇選擇私有 VPC 端點以進行安全資料傳輸。




endif::aws[]

ifdef::azure[]

* 從 Azure Blob 還原時，選擇目標磁碟區所在的ONTAP叢集中的 IP 空間，選擇用於存取物件儲存的 Azure 訂閱，並透過選擇 VNet 和子網路來選擇用於安全資料傳輸的私人端點。


endif::azure[]

ifdef::gcp[]

* 從 Google Cloud Storage 還原時，選擇 Google Cloud 專案以及存取金鑰和金鑰來存取物件儲存、儲存備份的區域以及目標磁碟區所在的ONTAP叢集中的 IP 空間。


endif::gcp[]

* 從StorageGRID還原時，輸入StorageGRID伺服器的 FQDN 和ONTAP應用於與StorageGRID進行 HTTPS 通訊的端口，選擇存取物件儲存所需的存取金鑰和金鑰，以及目標磁碟區所在的ONTAP叢集中的 IP 空間。
* 從ONTAP S3 還原時，輸入ONTAP S3 伺服器的 FQDN 和ONTAP應用於與ONTAP S3 進行 HTTPS 通訊的端口，選擇存取物件儲存所需的存取金鑰和金鑰，以及目標磁碟區所在的ONTAP叢集中的 IP 空間。
+
.. 輸入要用於復原的磁碟區的名稱，然後選擇磁碟區所在的儲存虛擬機器和聚合。還原FlexGroup磁碟區時，您需要選擇多個聚合。預設情況下，*<source_volume_name>_restore* 用作磁碟區名。
+
當將備份從物件儲存還原到使用ONTAP 9.13.0 或更高版本的Cloud Volumes ONTAP系統或執行ONTAP 9.14.1 的本機ONTAP系統時，您可以選擇執行_快速還原_操作。

+
如果您要從位於歸檔儲存層（從ONTAP 9.10.1 開始可用）中的備份檔案還原卷，則可以選擇還原優先權。

+
ifdef::aws[]





link:prev-reference-aws-archive-storage-tiers.html["了解有關從 AWS 檔案儲存恢復的更多信息"]。

endif::aws[]

ifdef::azure[]

link:prev-reference-azure-archive-storage-tiers.html["了解有關從 Azure 檔案儲存還原的詳細信息"]。

endif::azure[]

ifdef::gcp[]

link:prev-reference-gcp-archive-storage-tiers.html["詳細了解如何從 Google 存檔儲存中恢復"]。Google Archive 儲存層中的備份檔案幾乎可以立即恢復，並且不需要恢復優先順序。

endif::gcp[]

. 選擇「*下一步*」來選擇是否執行正常還原或快速還原程序：
+
** *正常還原*：在需要高效能的磁碟區上使用正常還原。還原過程完成之前，磁碟區將不可用。
** *快速恢復*：恢復的捲和資料將立即可用。請勿在需要高效能的磁碟區上使用此功能，因為在快速復原過程中，存取資料的速度可能會比平常慢。


. 選擇“*恢復*”，您將返回恢復儀表板，以便查看恢復操作的進度。


.結果
NetApp Backup and Recovery根據您選擇的備份建立一個新磁碟區。

請注意，從駐留在檔案儲存中的備份檔案還原磁碟區可能需要幾分鐘或幾小時，具體取決於檔案層和復原優先權。您可以選擇「作業監控」標籤來查看恢復進度。



=== 使用“瀏覽和還原”還原資料夾和文件

如果您只需要從ONTAP磁碟區備份中還原幾個文件，則可以選擇還原資料夾或單一文件，而不是還原整個磁碟區。您可以將資料夾和檔案還原到原始系統中的現有捲，或還原到使用相同雲端帳戶的其他系統。您也可以將資料夾和檔案還原到本機ONTAP系統上的磁碟區。


NOTE: 目前，您只能從物件儲存中的備份檔案還原資料夾或單一檔案。目前不支援從本機快照副本或駐留在輔助系統（複製磁碟區）中的備份檔案還原檔案和資料夾。

如果您選擇多個文件，則所有文件都會還原到您選擇的相同目標磁碟區。因此，如果您想將檔案還原到不同的捲，則需要多次執行復原過程。

使用ONTAP 9.13.0 或更高版本時，您可以還原資料夾以及其中的所有檔案和子資料夾。使用 9.13.0 之前的ONTAP版本時，僅還原該資料夾中的檔案 - 不會還原子資料夾或子資料夾中的檔案。

[NOTE]
====
* 如果備份檔案已配置 DataLock 和勒索軟體保護，則僅當ONTAP版本為 9.13.1 或更高版本時才支援資料夾級還原。如果您使用的是早期版本的ONTAP，則可以從備份檔案還原整個卷，然後存取所需的資料夾和檔案。
* 如果備份檔案駐留在檔案儲存中，則僅當ONTAP版本為 9.13.1 或更高版本時才支援資料夾層級還原。如果您使用的是早期版本的ONTAP，則可以從尚未存檔的較新備份檔案中還原資料夾，也可以從已存檔的備份中還原整個磁碟區，然後存取所需的資料夾和檔案。
* 使用ONTAP 9.15.1，您可以使用「瀏覽和復原」選項還原FlexGroup資料夾。此功能處於技術預覽模式。
+
您可以使用 https://community.netapp.com/t5/Tech-ONTAP-Blogs/BlueXP-Backup-and-Recovery-July-2024-Release/ba-p/453993#toc-hId-1830672444["NetApp Backup and Recovery2024 年 7 月版本博客"^]。



====


==== 先決條件

* ONTAP版本必須為 9.6 或更高版本才能執行_檔_復原操作。
* ONTAP版本必須為 9.11.1 或更高版本才能執行_資料夾_還原操作。如果資料位於檔案儲存中，或備份檔案使用 DataLock 和勒索軟體保護，則需要ONTAP版本 9.13.1。
* ONTAP版本必須為 9.15.1 p2 或更高版本才能使用瀏覽和還原選項還原FlexGroup目錄。




==== 資料夾和檔案還原過程

這個過程如下：

. 當您想要從磁碟區備份中還原資料夾或一個或多個檔案時，請按一下「還原」選項卡，然後按一下「瀏覽與復原」下的「復原檔案或資料夾」。
. 選擇資料夾或檔案所在的來源系統、磁碟區和備份檔案。
. NetApp Backup and Recovery顯示所選備份檔案中存在的資料夾和檔案。
. 選擇要從該備份中還原的資料夾或檔案。
. 選擇要還原資料夾或檔案的目標位置（系統、磁碟區和資料夾），然後按一下「*復原*」。
. 文件已恢復。


image:diagram_browse_restore_file.png["此圖顯示了使用瀏覽和復原執行檔復原操作的流程。"]

如您所見，您需要知道系統名稱、磁碟區名、備份檔案日期和資料夾/檔案名稱才能執行資料夾或檔案還原。



==== 還原資料夾和文件

請依照下列步驟將資料夾或檔案從ONTAP磁碟區備份還原到磁碟區。您應該知道要用於還原資料夾或檔案的磁碟區的名稱和備份檔案的日期。此功能使用即時瀏覽，以便您可以查看每個備份檔案中的目錄和檔案清單。

.步驟
. 從控制台選單中，選擇*保護>備份和還原*。
. 選擇“*恢復*”選項卡，將顯示“恢復儀表板”。
. 從「瀏覽和復原」部分，選擇「復原檔案或資料夾」。
. 在「選擇來源」頁面中，導覽至包含要還原的資料夾或檔案的磁碟區的備份檔案。選擇具有要從中復原檔案的日期/時間戳記的*系統*、*磁碟區*和*備份*。
. 選擇“*下一步*”，將顯示磁碟區備份中的資料夾和檔案清單。
+
如果您要從位於檔案儲存層的備份文件還原資料夾或文件，則可以選擇還原優先權。

+
link:prev-reference-aws-archive-storage-tiers.html["了解有關從 AWS 檔案儲存恢復的更多信息"]。link:prev-reference-azure-archive-storage-tiers.html["了解有關從 Azure 檔案儲存還原的詳細信息"]。link:prev-reference-gcp-archive-storage-tiers.html["詳細了解如何從 Google 存檔儲存中恢復"]。Google Archive 儲存層中的備份檔案幾乎可以立即恢復，並且不需要恢復優先順序。

+
如果備份檔案的勒索軟體復原功能處於活動狀態（如果您在備份策略中啟用了 DataLock 和勒索軟體復原功能），則會提示您在復原資料之前對備份檔案執行額外的勒索軟體掃描。我們建議您掃描備份檔案以尋找勒索軟體。  （您將需要向雲端提供者支付額外的出口費用才能存取備份檔案的內容。）

. 在「選擇項目」頁面中，選擇要復原的資料夾或文件，然後選擇「繼續」。為了幫助您找到該物品：
+
** 如果看到資料夾或檔案名，您可以選擇它。
** 您可以選擇搜尋圖示並輸入資料夾或檔案的名稱以直接導航到該項目。
** 您可以使用行尾的向下箭頭向下導航資料夾層級來尋找特定檔案。
+
當您選擇文件時，它們會被添加到頁面的左側，以便您可以看到已經選擇的文件。如果需要，您可以透過選擇檔案名稱旁邊的 *x* 從此清單中刪除檔案。



. 在「選擇目標」頁面中，選擇要還原項目的*系統*。
+
如果您選擇本地集群，並且尚未配置與物件儲存的集群連接，系統將提示您輸入其他資訊：

+
ifdef::aws[]

+
** 從 Amazon S3 還原時，輸入目標磁碟區所在的ONTAP叢集中的 IP 空間，以及存取物件儲存所需的 AWS 存取金鑰和金鑰。您也可以選擇專用連結配置來連接到叢集。




endif::aws[]

ifdef::azure[]

* 從 Azure Blob 還原時，輸入目標磁碟區所在的ONTAP叢集中的 IP 空間。您也可以為與叢集的連線選擇私有端點配置。


endif::azure[]

ifdef::gcp[]

* 從 Google Cloud Storage 復原時，輸入目標磁碟區所在的ONTAP叢集中的 IP 空間，以及存取物件儲存所需的存取金鑰和金鑰。


endif::gcp[]

* 從StorageGRID還原時，輸入StorageGRID伺服器的 FQDN 和ONTAP應用於與StorageGRID進行 HTTPS 通訊的端口，輸入存取物件儲存所需的存取金鑰和金鑰，以及目標磁碟區所在的ONTAP叢集中的 IP 空間。
+
.. 然後選擇要還原資料夾或檔案的*磁碟區*和*資料夾*。
+
恢復資料夾和檔案時，您有幾個位置選項可供選擇。



* 當您選擇“選擇目標資料夾”時，如上所示：
+
** 您可以選擇任意資料夾。
** 您可以將滑鼠懸停在資料夾上，然後按一下行尾以深入查看子資料夾，然後選擇一個資料夾。


* 如果您選擇了與來源資料夾/檔案相同的目標系統和磁碟區，則可以選擇*維護來源資料夾路徑*將資料夾或檔案還原到來源結構中存在的相同資料夾。所有相同的資料夾和子資料夾必須已經存在；不會建立資料夾。將檔案還原到原始位置時，您可以選擇覆蓋來源檔案或建立新檔案。
+
.. 選擇“*恢復*”，您將返回恢復儀表板，以便您可以查看恢復操作的進度。您也可以按一下「作業監控」標籤來查看復原進度。






== 使用“搜尋和還原”還原ONTAP數據

您可以使用「搜尋和還原」從ONTAP備份檔案還原磁碟區、資料夾或檔案。搜尋和還原可讓您從所有備份中搜尋特定的磁碟區、資料夾或文件，然後執行還原。您不需要知道確切的系統名稱、磁碟區名稱或檔案名稱—搜尋會查看所有磁碟區備份檔案。

搜尋操作會查看ONTAP磁碟區中存在的所有本機快照副本、二級儲存系統上的所有複製磁碟區以及物件儲存中存在的所有備份檔案。由於從本機 Snapshot 副本或複製磁碟區復原資料比從物件儲存中的備份檔案還原資料更快且成本更低，因此您可能會想要從這些其他位置還原資料。

當您從備份檔案還原_完整磁碟區_時， NetApp Backup and Recovery會使用備份中的資料建立一個_新_磁碟區。您可以將資料作為原始系統中的磁碟區還原到與來源系統位於相同雲端帳戶的其他系統或本機ONTAP系統。

您可以將資料夾或檔案還原到原始磁碟區位置、同一系統中的不同磁碟區、使用相同雲端帳戶的不同系統或本機ONTAP系統上的磁碟區。

使用ONTAP 9.13.0 或更高版本時，您可以還原資料夾以及其中的所有檔案和子資料夾。使用 9.13.0 之前的ONTAP版本時，僅還原該資料夾中的檔案 - 不會還原子資料夾或子資料夾中的檔案。

如果要還原的磁碟區的備份檔案位於檔案儲存中（從ONTAP 9.10.1 開始可用），則還原作業將花費更長的時間並產生額外的費用。請注意，目標叢集也必須執行ONTAP 9.10.1 或更高版本才能進行磁碟區還原、9.11.1 才能進行檔案還原、9.12.1 才能進行 Google Archive 和StorageGRID，以及 9.13.1 才能進行資料夾還原。

ifdef::aws[]

link:prev-reference-aws-archive-storage-tiers.html["了解有關從 AWS 檔案儲存恢復的更多信息"]。

endif::aws[]

ifdef::azure[]

link:prev-reference-azure-archive-storage-tiers.html["了解有關從 Azure 檔案儲存還原的詳細信息"]。

endif::azure[]

ifdef::gcp[]

link:prev-reference-gcp-archive-storage-tiers.html["詳細了解如何從 Google 存檔儲存中恢復"]。

endif::gcp[]

[NOTE]
====
* 如果物件儲存中的備份檔案已配置 DataLock 和勒索軟體保護，則僅當ONTAP版本為 9.13.1 或更高版本時才支援資料夾級還原。如果您使用的是早期版本的ONTAP，則可以從備份檔案還原整個卷，然後存取所需的資料夾和檔案。
* 如果物件儲存中的備份檔案駐留在檔案儲存中，則僅當ONTAP版本為 9.13.1 或更高版本時才支援資料夾層級還原。如果您使用的是早期版本的ONTAP，則可以從尚未存檔的較新備份檔案中還原資料夾，也可以從已存檔的備份中還原整個磁碟區，然後存取所需的資料夾和檔案。
* 將資料從 Azure 檔案儲存還原到StorageGRID系統時，不支援「高」還原優先權。
* 目前不支援從ONTAP S3 物件儲存中的磁碟區還原資料夾。


====
在開始之前，您應該對要還原的磁碟區或檔案的名稱或位置有所了解。



=== 搜尋和恢復支援的系統和物件儲存提供者

您可以將ONTAP資料從位於二級系統（複製磁碟區）或物件儲存（備份檔案）中的備份檔案還原到下列系統。快照副本駐留在來源系統上，並且只能還原到同一系統。

*注意：*您可以從任何類型的備份文件還原磁碟區和文件，但目前只能從物件儲存中的備份文件還原資料夾。

[cols="33,33,33"]
|===
2+| 備份檔案位置 | 目的地系統 


| *物件儲存（備份）* | *輔助系統（複製）* | ifdef::aws[] 


| 亞馬遜 S3 | AWS 本機ONTAP系統中的Cloud Volumes ONTAP | AWS 本機ONTAP系統中的Cloud Volumes ONTAP endif::aws[] ifdef::azure[] 


| Azure Blob | Azure 本地端ONTAP系統中的Cloud Volumes ONTAP | Azure 中的Cloud Volumes ONTAP本地ONTAP系統 endif::azure[] ifdef::gcp[] 


| Google 雲端儲存 | Google 本機ONTAP系統中的Cloud Volumes ONTAP | Google 本地ONTAP系統中的Cloud Volumes ONTAP endif::gcp[] 


| NetAppStorageGRID | 本機ONTAP系統Cloud Volumes ONTAP | 本地ONTAP系統 


| ONTAP S3 | 本機ONTAP系統Cloud Volumes ONTAP | 本地ONTAP系統 
|===
對於搜尋和還原，控制台代理可以安裝在以下位置：

ifdef::aws[]

* 對於 Amazon S3，控制台代理可以部署在 AWS 或您的場所


endif::aws[]

ifdef::azure[]

* 對於 Azure Blob，控制台代理程式可以部署在 Azure 中或您的本機


endif::azure[]

ifdef::gcp[]

* 對於 Google Cloud Storage，控制台代理程式必須部署在您的 Google Cloud Platform VPC 中


endif::gcp[]

* 對於StorageGRID，控制台代理必須部署在您的場所；無論是否有網路存取
* 對於ONTAP S3，控制台代理可以部署在您的場所（有或沒有網路存取）或雲端供應商環境中


請注意，「本地ONTAP系統」包括FAS、 AFF和ONTAP Select系統。



=== 先決條件

* 集群要求：
+
** ONTAP版本必須為 9.8 或更高版本。
** 磁碟區所在的儲存虛擬機器 (SVM) 必須具有配置的資料 LIF。
** 必須在磁碟區上啟用 NFS（支援 NFS 和 SMB/CIFS 磁碟區）。
** 必須在 SVM 上啟動 SnapDiff RPC 伺服器。當您在系統上啟用索引時，控制台會自動執行此操作。  （SnapDiff 是一種快速識別 Snapshot 副本之間檔案和目錄差異的技術。）




ifdef::aws[]

* AWS 需求：
+
** 必須將特定的 Amazon Athena、AWS Glue 和 AWS S3 權限新增至為控制台提供權限的使用者角色。link:prev-ontap-backup-onprem-aws.html["確保所有權限均已正確配置"]。
+
請注意，如果您已經使用過去設定的控制台代理程式來使用NetApp Backup and Recovery ，則現在需要將 Athena 和 Glue 權限新增至控制台使用者角色。它們是搜尋和恢復所必需的。





endif::aws[]

ifdef::azure[]

* Azure 需求：
+
** 您必須向您的訂閱註冊 Azure Synapse Analytics 資源提供者（稱為「Microsoft.Synapse」）。 https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/resource-providers-and-types#register-resource-provider["了解如何為您的訂閱註冊此資源提供程序"^] 。您必須是訂閱*擁有者*或*貢獻者*才能註冊資源提供者。
** 必須將特定的 Azure Synapse Workspace 和 Data Lake Storage 帳戶權限新增至為控制台提供權限的使用者角色。link:prev-ontap-backup-onprem-azure.html["確保所有權限均已正確配置"]。
+
請注意，如果您已經使用NetApp Backup and Recovery以及過去配置的控制台代理，則現在需要將 Azure Synapse Workspace 和 Data Lake Storage 帳戶權限新增至控制台使用者角色。它們是搜尋和恢復所必需的。

** 控制台代理必須配置為*不帶*代理伺服器才能與網際網路進行 HTTP 通訊。如果您已為控制台代理程式設定了 HTTP 代理伺服器，則無法使用搜尋和還原功能。




endif::azure[]

ifdef::gcp[]

* Google Cloud 需求：
+
** 必須將特定的 Google BigQuery 權限新增至為NetApp Console提供權限的使用者角色。link:prev-ontap-backup-onprem-gcp.html["確保所有權限均已正確配置"]。
+
如果您已經使用NetApp Backup and Recovery以及您過去設定的控制台代理，現在需要將 BigQuery 權限新增至控制台使用者角色。它們是搜尋和恢復所必需的。





endif::gcp[]

* StorageGRID和ONTAP S3 需求：
+
根據您的配置，有兩種方法可以實現“搜尋和還原”：

+
** 如果您的帳戶中沒有雲端提供者憑證，則索引目錄資訊將儲存在控制台代理程式上。
+
有關索引目錄 v2 的信息，請參閱下面有關如何啟用索引目錄的部分。

** 如果您在私人（暗）網站中使用控制台代理，則索引目錄資訊將儲存在控制台代理上（需要控制台代理版本 3.9.25 或更高版本）。
** 如果你有 https://docs.netapp.com/us-en/console-setup-admin/concept-accounts-aws.html["AWS 憑證"^]或者 https://docs.netapp.com/us-en/console-setup-admin/concept-accounts-azure.html["Azure 憑證"^]在帳戶中，索引目錄儲存在雲端提供者處，就像在雲端部署控制台代理程式一樣。  （如果您擁有這兩張憑證，則預設選擇 AWS。）
+
即使您使用的是本機控制台代理，也必須滿足控制台代理權限和雲端提供者資源的雲端提供者要求。使用此實作時，請參閱上面的 AWS 和 Azure 要求。







=== 搜尋和恢復過程

這個過程如下：

. 在使用搜尋和還原之前，您需要在要從中還原磁碟區資料的每個來源系統上啟用「索引」。這使得索引目錄可以追蹤每個卷的備份檔案。
. 當您想要從磁碟區備份中還原磁碟區或檔案時，在「搜尋與還原」下選擇「*搜尋和還原*」。
. 透過部分或完整磁碟區名稱、部分或完整檔案名稱、備份位置、大小範圍、建立日期範圍、其他搜尋篩選器輸入磁碟區、資料夾或檔案的搜尋條件，然後選擇*搜尋*。
+
搜尋結果頁面顯示具有符合搜尋條件的文件或磁碟區的所有位置。

. 選擇要用於還原磁碟區或檔案的位置的“查看所有備份”，然後在要使用的實際備份檔案上選擇“還原”。
. 選擇您想要復原磁碟區、資料夾或檔案的位置，然後選擇*復原*。
. 磁碟區、資料夾或檔案已恢復。


image:diagram_search_restore_vol_file.png["此圖顯示了使用「搜尋和還原」執行磁碟區、資料夾或檔案還原操作的流程。"]

如您所見，您實際上只需要知道部分名稱， NetApp Backup and Recovery就會搜尋與您的搜尋相符的所有備份檔案。



=== 為每個系統啟用索引目錄

在使用搜尋和還原之前，您需要在計劃還原磁碟區或檔案的每個來源系統上啟用「索引」。這使得索引目錄可以追蹤每個捲和每個備份檔案 - 使您的搜尋非常快速和有效率。

索引目錄是一個資料庫，用於儲存系統中所有磁碟區和備份檔案的元資料。搜尋和復原功能使用它來快速找到包含要復原的資料的備份檔案。

.索引目錄 v2 功能
索引目錄 v2 於 2025 年 2 月發布，並於 2025 年 6 月更新，其功能使其更有效率、更易於使用。此版本具有顯著的效能增強，並且預設為所有新客戶啟用。

回顧 v2 的以下注意事項：

* 索引目錄 v2 處於預覽模式。
* 如果您是現有客戶並且想要使用 Catalog v2，則需要完全重新索引您的環境。
* Catalog v2 僅索引具有快照標籤的快照。
* NetApp Backup and Recovery不會使用「每小時」 SnapMirror標籤對快照進行索引。如果您想使用「每小時」 SnapMirror標籤索引快照，則需要在 v2 處於預覽模式時手動啟用它。
* NetApp Backup and Recovery將僅使用 Catalog v2 為受NetApp Backup and Recovery保護的系統關聯的磁碟區和快照編製索引。在控制台平台上發現的其他系統將不會被編入索引。
* 使用 Catalog v2 進行資料索引發生在本機環境以及 Amazon Web Services、Microsoft Azure 和 Google Cloud Platform (GCP) 環境中。


索引目錄 v2 支援以下內容：

* 3分鐘內即可實現全球搜尋效率
* 最多 50 億個文件
* 每個集群最多 5000 個卷
* 每個磁碟區最多 10 萬個快照
* 基線索引的最長時間少於 7 天。實際時間將根據您的環境而有所不同。


.為系統啟用索引目錄
當您使用 Indexed Catalog v2 時，該服務不會提供單獨的儲存桶。相反，對於儲存在 AWS、Azure、Google Cloud Platform、 StorageGRID或ONTAP S3 中的備份，該服務會在控制台代理或雲端提供者環境上提供空間。

如果您在 v2 版本之前啟用了索引目錄，系統會出現下列情況：

* 對於儲存在 AWS 中的備份，它會提供一個新的 S3 bucket 和 https://aws.amazon.com/athena/faqs/["Amazon Athena 互動式查詢服務"^]和 https://aws.amazon.com/glue/faqs/["AWS Glue 無伺服器資料整合服務"^]。
* 對於儲存在 Azure 中的備份，它會提供一個 Azure Synapse 工作區和一個 Data Lake 檔案系統作為儲存工作區資料的容器。
* 對於儲存在 Google Cloud 中的備份，它會配置一個新的儲存桶，並且 https://cloud.google.com/bigquery["Google Cloud BigQuery 服務"^]在帳戶/項目層級進行配置。
* 對於儲存在StorageGRID或ONTAP S3 中的備份，它會在控制台代理或雲端提供者環境中提供空間。


如果您的系統已啟用索引，請前往下一部分以還原您的資料。

.為系統啟用索引的步驟：
. 執行下列操作之一：
+
** 如果沒有系統被索引，請在「復原儀表板」的「搜尋與復原」下，選擇「啟用系統索引」。
** 如果至少有一個系統已被索引，請在「搜尋和復原」下的「復原儀表板」上選擇「索引設定」。


. 為系統選擇*啟用索引*。


.結果
在所有服務都配置完畢並且索引目錄啟動後，系統將顯示為「活動」狀態。

根據系統中捲的大小以及所有 3 個備份位置的備份檔案數量，初始索引過程可能需要長達一個小時。此後，它會每小時透明地更新，並進行增量更改以保持最新狀態。



=== 使用「搜尋和還原」功能還原磁碟區、資料夾和文件

之後<<enable-the-indexed-catalog-for-each-working-environment,為您的系統啟用索引>>，您可以使用「搜尋和還原」還原磁碟區、資料夾和檔案。這使您可以使用廣泛的過濾器從所有備份檔案中找到要還原的確切檔案或磁碟區。

.步驟
. 從控制台選單中，選擇*保護>備份和還原*。
. 選擇“*恢復*”選項卡，將顯示“恢復儀表板”。
. 從“搜尋和恢復”部分，選擇“搜尋和恢復”。
. 從“搜尋和恢復”部分，選擇“搜尋和恢復”。
. 從「搜尋和還原」頁面：
+
.. 在「搜尋欄」中，輸入完整或部分磁碟區名稱、資料夾名稱或檔案名稱。
.. 選擇資源類型：*磁碟區*、*檔案*、*資料夾*或*全部*。
.. 在「過濾依據」區域中，選擇過濾條件。例如，您可以選擇資料所在的系統和檔案類型，例如 .JPEG 檔案。或者，如果您只想在物件儲存中可用的 Snapshot 副本或備份檔案中搜尋結果，則可以選擇備份位置的類型。


. 選擇*搜尋*，搜尋結果區域將顯示所有具有與您的搜尋相符的文件、資料夾或磁碟區的資源。
. 尋找包含您要復原的資料的資源，然後選擇「檢視所有備份」以顯示包含符合磁碟區、資料夾或檔案的所有備份檔案。
. 找到您想要用於還原資料的備份檔案並選擇*復原*。
+
請注意，結果會識別包含搜尋到的檔案的本機磁碟區 Snapshot 副本和遠端複製磁碟區。您可以選擇從雲端備份檔案、Snapshot 副本或複製磁碟區進行還原。

. 選擇要還原磁碟區、資料夾或檔案的目標位置，然後選擇*復原*。
+
** 對於卷，您可以選擇原始目標系統，也可以選擇備用系統。還原FlexGroup磁碟區時，您需要選擇多個聚合。
** 對於資料夾，您可以還原到原始位置，也可以選擇備用位置；包括系統、磁碟區和資料夾。
** 對於文件，您可以恢復到原始位置，也可以選擇備用位置；包括系統、磁碟區和資料夾。選擇原始位置時，您可以選擇覆蓋來源檔案或建立新檔案。
+
如果您選擇本機ONTAP系統，且尚未配置與物件儲存的叢集連接，系統將提示您輸入其他資訊：

+
ifdef::aws[]

+
*** 從 Amazon S3 還原時，選擇ONTAP叢集中目標磁碟區所在的 IP 空間，輸入您建立的使用者的存取金鑰和金鑰，以授予ONTAP叢集對 S3 儲存桶的存取權限，並可選擇選擇私有 VPC 端點以進行安全資料傳輸。link:prev-ontap-backup-onprem-aws.html["查看有關這些要求的詳細信息"]。






endif::aws[]

ifdef::azure[]

* 從 Azure Blob 還原時，選擇目標磁碟區所在的ONTAP叢集中的 IP 空間，並透過選擇 VNet 和子網路來選擇用於安全資料傳輸的私有端點。link:prev-ontap-backup-onprem-azure.html["查看有關這些要求的詳細信息"]。


endif::azure[]

ifdef::gcp[]

* 從 Google Cloud Storage 復原時，選擇目標磁碟區所在的ONTAP叢集中的 IP 空間，以及用於存取物件儲存的存取金鑰和金鑰。link:prev-ontap-backup-onprem-gcp.html["查看有關這些要求的詳細信息"]。


endif::gcp[]

* 從StorageGRID還原時，輸入StorageGRID伺服器的 FQDN 和ONTAP應用於與StorageGRID進行 HTTPS 通訊的端口，輸入存取物件儲存所需的存取金鑰和金鑰，以及目標磁碟區所在的ONTAP叢集中的 IP 空間。link:prev-ontap-backup-onprem-storagegrid.html["查看有關這些要求的詳細信息"]。
* 從ONTAP S3 還原時，輸入ONTAP S3 伺服器的 FQDN 和ONTAP應用於與ONTAP S3 進行 HTTPS 通訊的端口，選擇存取物件儲存所需的存取金鑰和金鑰，以及目標磁碟區所在的ONTAP叢集中的 IP 空間。link:prev-ontap-backup-onprem-ontaps3.html["查看有關這些要求的詳細信息"]。


.結果
磁碟區、資料夾或檔案已恢復，您將返回恢復儀表板，以便您可以查看恢復操作的進度。您也可以選擇「作業監控」標籤來查看恢復進度。看link:br-use-monitor-tasks.html["作業監控頁面"]。
